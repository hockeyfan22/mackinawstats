---
title: "historic shot data"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(here)
library(fuzzyjoin)
library(stringr)
library(ggthemes)
library(ggrepel)
library(extrafont)
library(hrbrthemes)
library(xkcd)
library(cowplot)
library(magick)

NHL = read_csv(here("shots20192.csv"))
NHL2 = read_csv(here("shots_2007-2017.csv"))
Shots = rbind(NHL2,NHL)
```

```{r}
myfile %>% 
       mutate(V5 = case_when(V1 == 1 & V2 != 4 ~ 1, 
                             V2 == 4 & V3 != 1 ~ 2,
                             TRUE ~ 0))

Shots %>% 
  filter(season != 2018) %>% 
  filter(playerPositionThatDidEvent != "G") %>% 
  mutate(forward = if_else(playerPositionThatDidEvent %in% c("L","R","D"),"F","D")) %>% 
  mutate(xGoal = case_when(season == 2012 ~ xGoal*1.7,
                           season == 2018 ~ xGoal*1.4,
                           TRUE ~ xGoal)) %>% 
  group_by(forward, season) %>%
  summarize(sumxG = sum(xGoal),
            meanxG = mean(xGoal)) %>% 
  ggplot(aes(season, sumxG, group = forward, color = forward)) +
  geom_line(size=3) +
  theme_economist() +
theme(axis.line.x = element_line(size = .5, colour = "black"),
legend.position = "bottom", legend.direction = "horizontal",
legend.title = element_blank(),
plot.title = element_text(family = "Roboto Condensed"),
text = element_text(family = "Roboto Condensed")) +
guides(fill = guide_legend(reverse = T))+
  labs(title = "Expected Goals by position, over time", subtitle="Data from Moneypuck.com",x = "Season", y="Expected Goals")+
  scale_x_continuous(breaks=c(2007,2010, 2012, 2015, 2017)) +
  theme(legend.position="none")
```

```{r}
#trying per 60 minutes for 5v5 and PP
Shots %>% 
  filter(playerPositionThatDidEvent != "G") %>% 
  mutate(forward = if_else(playerPositionThatDidEvent %in% c("L","R","D"),"F","D")) %>% 
  group_by(game_id,forward, season) %>% 
  summarize(sumxG = sum(xGoal)) %>% 
  mutate(minutesingame = rep(60)) %>% 
  mutate(xGoalper60 = sumxG/minutesingame) %>% 
  group_by(forward, season) %>%
  summarize(sumxGper60 = sum(xGoalper60))

Time = Shots %>% 
  group_by(game_id, season) %>% 
  summarize(xG = sum(xGoal)) %>% 
  mutate(minutesingame = rep(60)) %>% 
  group_by(season) %>% 
  summarize(sum(minutesingame))
  
```

